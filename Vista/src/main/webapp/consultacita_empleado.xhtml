<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<header>
    <div class="top-bar">
        <h:graphicImage name="images/logo.png" alt="Logo Dental Patron" style="height: 60px;"/>
    </div>
    <nav class="main-nav">
        <a href="inicio_emp.xhtml" class="nav-item">INICIO</a>
        <a href="pacientes.xhtml" class="nav-item">GESTION PACIENTES</a>
        <a href="#" class="active">CONSULTAR CITAS</a>
        <a href="corte_caja.xhtml" class="nav-item">CAJA</a>



    </nav>
</header>

<h:head>
    <title>Consulta de Citas</title>
    <h:outputStylesheet name="css/patrondental.css" />

    <style>
        body { background-color: #e0f2f1; font-family: 'Poppins', sans-serif; margin: 0; }

        .main-container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 20px;
        }

        .header-wrapper {
            text-align: center;
            margin-bottom: 30px;
            margin-top: 10px;
        }


        .page-title {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 15px 60px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);

            display: inline-block;

            color: #00695c;
            font-size: 1.8rem;
            font-weight: 600;
            margin: 0;
            border: 1px solid #e0f2f1;
        }

        .view-switcher-container {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        .view-btn {
            padding: 8px 20px;
            border: 1px solid #ccc;
            text-decoration: none;
            font-family: 'Poppins', sans-serif;
            color: #333;
            background-color: white;
            transition: all 0.2s;
        }
        .view-btn.first { border-radius: 4px 0 0 4px; border-right: none; }
        .view-btn.last { border-radius: 0 4px 4px 0; }

        .view-btn.active {
            background-color: #333;
            color: white;
            border-color: #333;
        }
        .view-btn:hover:not(.active) { background-color: #f5f5f5; }


        .cards-container { display: flex; flex-direction: column; gap: 15px; }
        .cita-card {
            background-color: #80cbc4; border-radius: 12px; padding: 15px 20px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1); display: flex; align-items: center;
            color: #004d40; position: relative;
        }

        .cita-detalles {
            color: #666;
            font-size: 0.95rem;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .cita-motivo {
            font-style: italic;
            color: #00695c;
        }

        .estado-badge {
            background-color: #e0f2f1;
            color: #004d40;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.85rem;
            text-transform: uppercase;
        }


        .top-bar { padding: 10px 20px; background: white; border-bottom: 1px solid #ddd; display: flex; align-items: center;}
        .main-nav { background: #004d40; padding: 15px; display: flex; gap: 20px; justify-content: center; }
        .main-nav a, .main-nav span { color: white; text-decoration: none; font-weight: 500; font-size: 1.1em;}
        .main-nav .active {
            background-color: #000000 !important;
            color: #80cbc4 !important;
            border: 1px solid #80cbc4 !important;
            border-radius: 8px !important;

            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;

            height: 40px !important;
            padding: 0 25px !important;

            font-size: 16px !important;
            font-weight: bold !important;
            text-decoration: none !important;
            text-transform: uppercase !important;
            line-height: 1 !important;
            box-sizing: border-box !important;
        }

        .view-btn.first {
            border-radius: 4px 0 0 4px;
            border-right: none;
        }

        .view-switcher-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .view-btn {
            padding: 8px 20px;
            border: 1px solid #ccc;
            text-decoration: none;
            font-family: 'Poppins', sans-serif;
            font-size: 0.95rem;
            color: #333;
            background-color: white;
            transition: all 0.2s ease;
        }

        .view-btn.first {
            border-radius: 4px 0 0 4px;
            border-right: none;
        }

        .view-btn.last {
            border-radius: 0 4px 4px 0;
        }

        .view-btn.active {
            background-color: #333;
            color: white;
            border-color: #333;
        }

        .view-btn:hover:not(.active) {
            background-color: #f5f5f5;
        }
    </style>
</h:head>

<h:body>
    <main class="main-container">

        <div class="view-switcher-container">
            <a href="#" class="view-btn last active">Ver Lista</a>
            <p:link outcome="agenda_calendario" value="Ver Calendario" styleClass="view-btn first" />
        </div>

        <h2 class="page-title">Citas Programadas</h2>
        <!-- checar este -->
        <div class="header-wrapper">
            <h2 class="page-title">Lista de Citas</h2>
        </div>

        <div class="view-switcher-container">
            <a href="#" class="view-btn first active">Ver Lista</a>

            <p:link outcome="agenda_calendario" value="Ver Calendario" styleClass="view-btn last" />
        </div>

        <h:form id="formCitas">

            <p:growl id="msg" showDetail="true" life="5000"/>

            <div class="cards-container">
                <ui:repeat value="#{citaConsultaBean.listaCitas}" var="c">
                    <div class="cita-card">
                        <div class="cita-info">
                            <h:outputText value="#{c.idPaciente.nombre} #{c.idPaciente.apellido}" />
                            -
                            <h:outputText value="#{c.fecha}">
                                <f:convertDateTime type="localDate" pattern="dd 'de' MMMM" locale="es_MX"/>
                            </h:outputText>
                            -
                            <h:outputText value="#{c.hora}">
                                <f:convertDateTime type="localTime" pattern="h:mm a" locale="es_MX"/>
                            </h:outputText>
                            -
                            <h:outputText value="#{c.motivo}" />
                            -
                            <h:outputText value="#{c.estado}" styleClass="estado"/>
                        </div>

                        <div class="cita-date">
                            <h:outputText value="#{c.fecha}">
                                <f:convertDateTime type="localDate" pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </div>

                        <div style="margin-top: 10px; display: flex; gap: 10px;">

                            <p:commandButton value="Cambiar Estado"
                                             icon="pi pi-refresh"
                                             actionListener="#{citaConsultaBean.seleccionarCita(c)}"
                                             oncomplete="PF('dlgEstado').show()"
                                             process="@this"/>

                            <p:commandButton value="Enviar Receta"
                                             icon="pi pi-envelope"
                                             actionListener="#{citaConsultaBean.enviarReceta(c)}"
                                             process="@this"
                                             update="@this :formCitas:msg"
                                             styleClass="ui-button-success"
                                             style="font-weight: bold; padding: 5px 15px; font-size: 0.95rem;"/>
                        </div>
                    </div>

                    <p:dialog id="dlgEstado" widgetVar="dlgEstado" header="Cambiar Estado" modal="true" resizable="false">

                        <h:panelGrid columns="2" cellpadding="5">
                            <h:outputLabel for="estadoSelect" value="Estado:"/>

                            <p:selectOneMenu id="estadoSelect" value="#{citaConsultaBean.estadoSeleccionado}">
                                <f:selectItem itemValue="Pendiente" itemLabel="Pendiente"/>
                                <f:selectItem itemValue="Programada" itemLabel="Programada"/>
                                <f:selectItem itemValue="Completada" itemLabel="Completada"/>
                                <f:selectItem itemValue="Cancelada" itemLabel="Cancelada"/>
                            </p:selectOneMenu>
                        </h:panelGrid>

                        <p:separator/>

                        <p:commandButton value="Guardar"
                                         actionListener="#{citaConsultaBean.actualizarEstado}"
                                         update=":formCitas"
                                         oncomplete="PF('dlgEstado').hide()"/>
                    </p:dialog>


                </ui:repeat>

                <h:panelGroup rendered="#{empty citaConsultaBean.listaCitas}">
                    <div style="text-align: center; padding: 20px; color: #666;">
                        <h3>No hay citas registradas.</h3>
                    </div>
                </h:panelGroup>

            </div>

        </h:form>

    </main>
</h:body>
</html>